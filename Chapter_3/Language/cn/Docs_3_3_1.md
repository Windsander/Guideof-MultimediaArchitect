
# 3.3.1 方向梯度直方图（HOG [Histogram of Oriented Gradient]）

在前文中，我们提到了索贝尔滤波（Sobel Filter）卷积核对中心点周边方向信息的提炼，可以被用来获取方向梯度直方图的梯度矢量计算中。那么什么是方向梯度直方图呢？

方向梯度直方图最早的 **概念原型（Prototype）** 来自于 **罗伯特·麦康纳尔（Robert K. McConnell）** 在 1986 年申请的有关模式识别专利中，对 **视野（FoV [Field of View]）** 方向性输入产生输出结果差异的判断过程。并于 1994 年 **三菱电子研究实验室（Mitsubishi Electric Research Laboratories）** 在手势识别应用的区域检测过程中，首次总结为当前称谓 [\[16\]][ref]  。**最终经过 2005 年 CVPR 顶会参会论文验证，重新确认了 HOG 在动态检测上的高适配度，才开始被人熟知** [\[17\]][ref] 。

**方向梯度直方图（HOG [Histogram of Oriented Gradient]）** 是对用于提炼并描述区域范围内像素漂移情况方法论的概念抽象。是对过程的抽象，而非对结果的抽象。由于本身最终运算能够表示为处理单元形式，因而属于 **特征描述算子（Feature Descriptor）** 的一种。整体思想则是在单元间隔均匀的卷积核内，使用重叠的局部梯度提炼算法并 **录表统计归一化（Normalization）** ，以取得中心点变化方向矢量。方法常结合 **阈值限定（Thresholding）** 筛选结果，提高运动预测的准确度。

显然，方向梯度直方图并不只适用于索贝尔， **只要能够提供中心点周边梯度变化的大小和方向的算子，都可以被应用于 HOG 的求解中** 。一个方向梯度直方图是否优秀，最大的影响点就在于梯度提炼的是否精准。

## **HOG 的标准处理流**

HOG 有一套相对固定的标准过程的。基本可以按照如下顺序进行：

1. 数据优化，通过滤波算法（如高斯滤波），减少干扰信息并增强灰度（光亮度）对比；
2. 梯度计算，通过梯度滤波器（如索贝尔滤波）提取图像每个像素的梯度矢量；
3. 分组抽象，指定梯度矢量采样卷积核范围，即分组（Cell）
4. 矢量合并，将分组内所有像素的梯度矢量，以方向投票统计合并权重，获取 HOG
5. 块归一化，指定块大小（由分组为单位），整合 HOG 统计结果并归一化快内分组权重

五个步骤，共同构成了方向梯度直方图方法论本身。

## **数据优化**

数据优化的目的是为了增强光亮度变化差异，并减少干扰噪声，从而更好的保存并放大像素梯度变化情况。我们记原信号为 $$S(x)$$ ，记经过滤波降噪和修饰后的灰度（光亮度）数据为 $$S_g(x)$$ 。从 $$S(x)$$ 到 $$S_g(x)$$ 的处理过程就不再赘述（见滤波，类比处理）。记经过优化函数 $$O_g(x)$$ 处理，以 $$S_g(x)$$ 获取的优化结果为 $$S_o(x)$$ 。那么，相对简单的处理方式，就是直接对 $$S_g(x)$$ 进行 伽马矫正（Gamma Correction）来得到 $$S_o(x)$$ 。取伽马因子为 $$\gamma$$ ，矫正系数（Adjust Factor）为 $$A$$ （一般情况 $$A = 1.0$$ 为常量），有：

$$
{\displaystyle 
 \begin{aligned}
    O_g(x) =& Gamma(S) = A \cdot S(x)^{\gamma} \\
 \end{aligned}
}
$$

**伽马矫正（Gamma Correction）** 本是用于应对，早期 **阴极射线管（CRT [Cathode Ray Tube]）显示器** 的电子偏转特征，引入的采样源数据非线性转换算法。传统的 CRT 显示器在显示时就会完成对偏转数据的自然逆向过程，而在 **液晶显示器（LCD [Liquid Crystal Display]）** 上，则需要 **主动的实现这一反向运算** ，否则会面临数据亮度过爆的问题。

由于采样时采用 $$\gamma < 1$$ 应用于数据修正, 所以 $$\gamma < 1$$ 时的 $$\gamma$$ 值被称为 **编码伽马值（Encoding Gamma）** 。相应的，$$\gamma > 1$$ 时的 $$\gamma$$ 值被称为 **解码伽马值（Decoding Gamma）** 。而采样到还原的过程中，对伽马矫正的不同运用被分别称为 **伽马编码（Gamma Encode）** 和 **伽马解码（Gamma Decode）** 。

<center>
<figure>
   <img  
      width = "500" height = "200"
      src="../../Pictures/gamma_correction_flow_02.png" alt="">
    <figcaption>
      <p>图 3.3.1-1 原数据经过伽马编解码（伽马矫正）的还原过程示意图</p>
   </figcaption>
</figure>
</center>

	
伽马矫正本身的作用正是针对原图色彩通道数据，进行非线性的映射。衍生为对图片整体光亮度的调节，因此在灰度值上的体现最为明显。我们利用这种特性，来增强图片的对比信息，放大像素梯度变化。

这一步，通常取用 $$\gamma \in [0.45,\ 1.25]$$ 区间内的值，或 $$\gamma = 0.5$$ 的原论文推荐值来进行修正。得到用于后续处理的灰度数据源 $$S_o(x)$$ 。

## **梯度计算**


[ref]: References_3.md